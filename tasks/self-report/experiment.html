<!DOCTYPE html>
<html>
<head>
  <title>Self Report</title>

  <!-- Load libraries -->
  <script src="./lib/jspsych-6.3.1/jspsych.js"></script>

  <!-- Load jsPsych plug-ins -->
  <script src="./jspsych-survey-demo.js"></script>
  <script src="./jspsych-survey-debrief.js"></script>
  <script src="./jspsych-survey-template.js"></script>
  <script src="./jspsych-mental-health-alert.js"></script>

  <!-- Load CSS styles -->
  <link href="./lib/jspsych-6.3.1/css/jspsych.css" rel="stylesheet" type="text/css"></link>
</head>
<body></body>
<script>

  // Display alert message on back/refresh.
  // https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload
  function verify_unload(e){
    e.preventDefault();
    (e || window.event).returnValue = null;
    return null;
  };
  window.addEventListener("beforeunload", verify_unload);

  // Define demographics form.
  var DEMO = {
    type: 'survey-demo'
  }

  // Define debriefing form.
  var DEBRIEF = {
    type: 'survey-debrief'
  }

  // Define mental health alert.
  var MHA = {
    type: 'mental-health-alert'
  }

  // Define survey.
  var SURVEY = {
    type: 'survey-template',
    items: [
      "Feeling nervous, anxious, or on edge",
      "Not being able to stop or control worrying",
      "Worrying too much about different things",
      "Trouble relaxing",
      "Being so restless that it's hard to sit still",
      "Becoming easily annoyed or irritable",
      "Feeling afraid as if something awful might happen"
    ],
    scale: [
      "Not at all",
      "Several days",
      "Over half the days",
      "Nearly every day"
    ],
    reverse: [
    false, false, false, false, false, false, false
    ],
    instructions: 'Over the last 2 weeks, how often have you been bothered by the following problems?',
    survey_width: 950,
    item_width: 40
  }

  // Query URL
  const urlParams = new URLSearchParams(window.location.search);
  const show_plugin = urlParams.get('plugin');

  // Initialize timeline.
  var timeline = [];
  if (show_plugin == "demo") {
    timeline = timeline.concat(DEMO);
  } else if (show_plugin == "debrief") {
    timeline = timeline.concat(DEBRIEF);
  } else if (show_plugin == "survey") {
    timeline = timeline.concat(SURVEY);
  } else if (show_plugin == "mha") {
    timeline = timeline.concat(MHA);
  } else {
    timeline = timeline.concat(SURVEY);
    timeline = timeline.concat(MHA);
    timeline = timeline.concat(DEMO);
    timeline = timeline.concat(DEBRIEF);
  }

  jsPsych.init({
    timeline: timeline,
    show_progress_bar: true,
    on_finish: function() {

      // Remove requirement to verify redirect
      window.removeEventListener("beforeunload", verify_unload);

      // Add interactions to the data variable
      var interaction_data = jsPsych.data.getInteractionData();
      jsPsych.data.get().addToLast({interactions: interaction_data.json()});

      // Display jsPsych data in viewport.
      jsPsych.data.displayData();

    }
  })

</script>
</html>
